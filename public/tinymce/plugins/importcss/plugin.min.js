tinymce.PluginManager.add("importcss",function(e){function t(e){return"string"==typeof e?function(t){return t.indexOf(e)!==-1}:e instanceof RegExp?function(t){return e.test(t)}:e}function n(t,n){function r(e,t){var a,s=e.href;if(s&&n(s,t)){o(e.imports,function(e){r(e,!0)});try{a=e.cssRules||e.rules}catch(e){}o(a,function(e){e.styleSheet?r(e.styleSheet,!0):e.selectorText&&o(e.selectorText.split(","),function(e){i.push(tinymce.trim(e))})})}}var i=[],a={};o(e.contentCSS,function(e){a[e]=!0}),n||(n=function(e,t){return t||a[e]});try{o(t.styleSheets,function(e){r(e)})}catch(e){}return i}function r(t){var n,r=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(t);if(r){var i=r[1],o=r[2].substr(1).split(".").join(" "),a=tinymce.makeMap("a,img");return r[1]?(n={title:t},e.schema.getTextBlockElements()[i]?n.block=i:e.schema.getBlockElements()[i]||a[i.toLowerCase()]?n.selector=i:n.inline=i):r[2]&&(n={inline:"span",title:t.substr(1),classes:o}),e.settings.importcss_merge_classes!==!1?n.classes=o:n.attributes={class:o},n}}var i=this,o=tinymce.each;e.on("renderFormatsMenu",function(a){var s=e.settings,l={},c=s.importcss_selector_converter||r,d=t(s.importcss_selector_filter),u=a.control;e.settings.importcss_append||u.items().remove();var f=[];tinymce.each(s.importcss_groups,function(e){e=tinymce.extend({},e),e.filter=t(e.filter),f.push(e)}),o(n(a.doc||e.getDoc(),t(s.importcss_file_filter)),function(t){if(t.indexOf(".mce-")===-1&&!l[t]&&(!d||d(t))){var n,r=c.call(i,t);if(r){var o=r.name||tinymce.DOM.uniqueId();if(f)for(var a=0;a<f.length;a++)if(!f[a].filter||f[a].filter(t)){f[a].item||(f[a].item={text:f[a].title,menu:[]}),n=f[a].item.menu;break}e.formatter.register(o,r);var s=tinymce.extend({},u.settings.itemDefaults,{text:r.title,format:o});n?n.push(s):u.add(s)}l[t]=!0}}),o(f,function(e){u.add(e.item)}),a.control.renderNew()}),i.convertSelectorToFormat=r});