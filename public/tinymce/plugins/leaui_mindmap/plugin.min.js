var LEAUI_MIND={};tinymce.PluginManager.add("leaui_mindmap",function(e,t){function n(){function n(){var n=e.settings.language,r=t+"/mindmap/index.html?i=1",i='<iframe id="leauiMindMapIfr" src="'+r+"?"+(new Date).getTime()+"&lang="+n+'" frameborder="0"></iframe>';return i}var r=e.dom,i=e.selection.getContent(),o=/<img.*?\/>/g,a=i.match(o),s=document.createElement("p");LEAUI_MIND={};for(var l in a){s.innerHTML=a[l];var c=s.firstChild;if(c&&"IMG"==c.nodeName){LEAUI_MIND.json=r.getAttrib(c,"data-mind-json");break}}var d=window.innerWidth-10,u=window.innerHeight-150;win=e.windowManager.open({title:"Mind Map",width:d,height:u,html:n(),buttons:[{text:"Cancel",onclick:function(){this.parent().parent().close()}},{text:"Insert",subtype:"primary",onclick:function(t){var n=this,r=document.getElementById("leauiMindMapIfr").contentWindow,i=r.km;i.exportData("png").then(function(t){var r=JSON.stringify(i.exportJson());r=r.replace(/'/g,"\u0416");var o='<img src="'+t+'" data-mce-src="-" data-mind-json=\''+r+"'>";e.insertContent(o),n.parent().parent().close()})}}]})}e.addButton("leaui_mindmap",{icon:"mind",tooltip:"Insert/edit mind map",onclick:n,stateSelector:"img[data-mind-json]"})});