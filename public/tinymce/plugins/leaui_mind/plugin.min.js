var LEAUI_MIND={};tinymce.PluginManager.add("leaui_mind",function(e,t){function n(){function t(){var t=e.settings.language,n="//leanote.com/public/libs/mind/edit.html",r='<iframe id="leauiIfr" src="'+n+"?"+(new Date).getTime()+"&lang="+t+'" frameborder="0"></iframe>';return r}var n=e.dom,r=e.selection.getContent(),i=/<img.*?\/>/g,o=r.match(i),a=document.createElement("p");LEAUI_MIND={};for(var s in o){a.innerHTML=o[s];var l=a.firstChild;if(l&&"IMG"==l.nodeName){LEAUI_MIND.json=n.getAttrib(l,"data-mind-json");break}}var c=$(document).width()-10,d=$(document).height()-100;win=e.windowManager.open({title:"Mind Map",width:c,height:d,html:t(),buttons:[{text:"Cancel",onclick:function(){this.parent().parent().close()}},{text:"Insert Mind Map",subtype:"primary",onclick:function(t){var n=this,r=document.getElementById("leauiIfr").contentWindow,i=r.km;return void i.exportData("png").then(function(t){var r=JSON.stringify(i.exportJson()),o='<img src="'+t+'" data-mce-src="-" data-mind-json=\''+r+"'>";e.insertContent(o),n.parent().parent().close()})}}]})}e.addButton("leaui_mind",{icon:"mind",tooltip:"Insert/edit mind map",onclick:n,stateSelector:"img[data-mind-json]"})});